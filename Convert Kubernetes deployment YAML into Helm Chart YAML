Convert Kubernetes deployment YAML into Helm Chart YAML

1.Create kubernetes deployment YAML(k8s-deployment.yaml)
vi k8s-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  creationTimestamp: null
  labels:
    app: demo
  name: demo
spec:
  replicas: 1
  selector:
    matchLabels:
      app: demo
  strategy: {}
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: demo
    spec:
      containers:
      - image: rahulwagh17/kubernetes:jhooq-k8s-springboot
        name: kubernetes
        resources: {}
status: {}

2. Deploy k8s-deployment.yaml
kubectl apply -f k8s-deployment.yaml
-Check deployment status
kubectl get deployment demo
NAME   READY   UP-TO-DATE   AVAILABLE   AGE
demo   1/1     1            1           4m52s

3. Create kubernetes service YAML(k8s-service.yaml)
vi k8s-service.yaml
apiVersion: v1
kind: Service
metadata:
  creationTimestamp: null
  labels:
    app: demo
  name: demo-service
spec:
  ports:
  - port: 8080
    protocol: TCP
    targetPort: 8080
  selector:
    app: demo
  type: NodePort
status:
  loadBalancer: {}
  
 Run the following kubectl command to expose the service as NodePort on port 8080

kubectl apply -f k8s-service.yaml 
  
Check the service status by running following command

kubectl get service demo-service 
NAME           TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE
demo-service   NodePort   10.233.10.61   <none>        8080:30036/TCP   9s

4. Convert kubernetes YAML to Helm Chart
Here is comparision of YAMLs generated by Helm Chart and Kubernetes(k8s) -

YAMLs Generated by Helm Chart			Kubernetes(k8s) YAMLs
1	Chart.yaml	
2	helper.tpl	
3	deployment.yaml							k8s-deployment.yaml
4	hpa.yaml	
5	ingress.yaml	
6	service.yaml							k8s-service.yaml
7	serviceaccount.yaml	
8	test-connection.yaml	
9	values.yaml								In k8s-deployment.yaml
 											1. replicas: 1
 											2. docker image =rahulwagh17/kubernetes:jhooq-k8s-springboot
Lets create demo-helm-chart
helm create demochart
tree demochart
demochart
├── Chart.yaml
├── charts
├── templates
│ ├── NOTES.txt
│ ├── _helpers.tpl
│ ├── deployment.yaml
│ ├── hpa.yaml
│ ├── ingress.yaml
│ ├── service.yaml
│ ├── serviceaccount.yaml
│ └── tests
│     └── test-connection.yaml
└── values.yaml 
5. Convert and Update Chart.yaml, deployment.yaml, service.yaml and values.yaml

So update the following values inside your chart.yaml

apiVersion: v2
name: demochart
description:  Convert Kubernetes(yamls) to Helm Chart
type: application
version: 0.1.0
appVersion: 1.16.0

6. deployment.yaml
The next YAML to convert is deployment.yaml but here we need to add/remove from deployment.yaml

           - name: http
              containerPort: 8080 #update the port here to 8080
              protocol: TCP
          livenessProbe: #Remove from here 
            httpGet:
              path: /
              port: http
          readinessProbe:
            httpGet:
              path: /
              port: http   #till here
          resources:
          
7. service.yaml we don't have to do anything ..

The last YAMLs which is left for conversion is values.yaml and here we need to update couple values -
Need to update as following .. 
replicaCount: 1

image:
  repository: rahulwagh17/kubernetes:jhooq-k8s-springboot #update the docker image name
  pullPolicy: IfNotPresent
  -----
  ---
service:
  type: NodePort
  port: 8080


8. Verify the Conversion of YAMLs
helm template demohelmchart

helm lint demochart
==> Linting demochart
[INFO] Chart.yaml: icon is recommended

1 chart(s) linted, 0 chart(s) failed 

























